//Relative Permeability Model

//updating non-relative permeabilities

k1 =k01*((1-epss)*(1-epss)*(1-epss))/(epss*epss);

k2 =k02*((1-epss)*(1-epss)*(1-epss))/(epss*epss);

//Calculating effective saturation
alpha1effPerm = (alpha1-alpha1IrrPerm)/(1-alpha1IrrPerm-alpha2IrrPerm);

alpha1effPerm.max(1e-3);
alpha1effPerm.min(1-1e-3);

////Brooks and Corey Model Relative Permeabilities
k1rel=pow(alpha1effPerm,m);
k2rel=pow((1-alpha1effPerm),m);

//VanGenutchen Model Relative Permeabilities
//k1rel=pow(alpha1effPerm,0.5)*pow(1-pow(1-pow(alpha1effPerm,1/m),m),2);

//k2rel=pow(1-alpha1effPerm,0.5)*pow(1-pow(alpha1effPerm,1/m),2*m);

//modify permabilities
k1real=k1*k1rel;
k2real=k2*k2rel;

//calculating final comprehensive permeability 
kinv=1/(alpha1*k1real+alpha2*k2real); 

//adjust so that both phases have the same permeability in free space.

forAll(kinv,celli)
{
	if (epss[celli]<0.001) //if in clay
		{kinv[celli]= 1e-20;}
}
